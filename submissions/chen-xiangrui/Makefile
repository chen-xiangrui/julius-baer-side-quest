.PHONY: help install test format lint docker-build docker-run docker-compose-up docker-compose-down clean run

help:
	@echo "ðŸ¦ Modern Banking Client - Make Commands"
	@echo "========================================"
	@echo ""
	@echo "Available commands:"
	@echo "  make install          - Install dependencies"
	@echo "  make run              - Run the banking client"
	@echo "  make test             - Run all tests"
	@echo "  make test-unit        - Run unit tests only"
	@echo "  make test-int         - Run integration tests only"
	@echo "  make test-endpoints   - Test all API endpoints"
	@echo "  make format           - Format code with black and isort"
	@echo "  make lint             - Lint code with flake8"
	@echo "  make typecheck        - Type check with mypy"
	@echo "  make quality          - Run all quality checks"
	@echo "  make docker-build     - Build Docker image"
	@echo "  make docker-run       - Run Docker container"
	@echo "  make docker-compose-up    - Start server and client with docker-compose"
	@echo "  make docker-compose-down  - Stop docker-compose services"
	@echo "  make server           - Start banking server"
	@echo "  make clean            - Clean up temporary files"
	@echo ""

install:
	@echo "ðŸ“¦ Installing dependencies..."
	python3 -m venv venv
	. venv/bin/activate && pip install -r requirements.txt
	@echo "âœ… Dependencies installed"

run:
	@echo "ðŸš€ Running banking client..."
	. venv/bin/activate && python banking_client.py --from ACC1000 --to ACC1001 --amount 100.00

test:
	@echo "ðŸ§ª Running all tests..."
	. venv/bin/activate && pytest tests/ -v

test-unit:
	@echo "ðŸ§ª Running unit tests..."
	. venv/bin/activate && pytest tests/test_transfer.py -v

test-int:
	@echo "ðŸ§ª Running integration tests..."
	. venv/bin/activate && pytest tests/test_integration.py -v -m integration

format:
	@echo "ðŸŽ¨ Formatting code..."
	. venv/bin/activate && black .
	. venv/bin/activate && isort .
	@echo "âœ… Code formatted"

lint:
	@echo "ðŸ” Linting code..."
	. venv/bin/activate && flake8 .
	@echo "âœ… Linting passed"

typecheck:
	@echo "ðŸ” Type checking..."
	. venv/bin/activate && mypy . || true
	@echo "âœ… Type checking complete"

quality: format lint typecheck
	@echo "âœ… All quality checks passed"

docker-build:
	@echo "ðŸ³ Building Docker image..."
	docker build -t modern-banking-client .
	@echo "âœ… Docker image built"

docker-run:
	@echo "ðŸ³ Running Docker container..."
	docker run --rm modern-banking-client --from ACC1000 --to ACC1001 --amount 100

docker-compose-up:
	@echo "ðŸ³ Starting services with docker-compose..."
	docker-compose up --build

docker-compose-down:
	@echo "ðŸ³ Stopping docker-compose services..."
	docker-compose down

test-endpoints:
	@echo "ðŸ§ª Testing all API endpoints..."
	chmod +x test_endpoints.sh
	./test_endpoints.sh

server:
	@echo "ðŸš€ Starting banking server..."
	docker run -d -p 8123:8123 singhacksbjb/sidequest-server:latest
	@echo "âœ… Server started at http://localhost:8123"

clean:
	@echo "ðŸ§¹ Cleaning up..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.log" -delete 2>/dev/null || true
	rm -rf .pytest_cache .mypy_cache htmlcov .coverage 2>/dev/null || true
	@echo "âœ… Cleanup complete"
